var cnc;var cncCtx;function drawBillet(a){cncCtx.fillStyle=a.properties.color;cncCtx.fillRect(-a.length,-a.radius,a.length,a.radius*2)}function highlightEdge(l,b){var d=l.getImageData(0,l.canvas.height/2-b.radius-1,b.length,b.radius+1);var c={DOWN:0,RIGHT:1,UP:2};var f=c.DOWN;function k(m){}function a(m){var i=m.toString(16);return i.length==1?"0"+i:i}function h(n,m,i){return("#"+a(n)+a(m)+a(i)).toUpperCase()}function j(n){var m=h(d.data[n],d.data[n+1],d.data[n+2]);return m==="#FFFFFF"}var e=[];for(var g=0;g<d.data.length;g+=4){if(j(g)){d.data[g]=0;d.data[g+1]=255;d.data[g+2]=0;d.data[g+3]=128}else{d.data[g]=0;d.data[g+1]=0;d.data[g+2]=255;d.data[g+3]=128}}l.putImageData(d,50,50)}function initSimulation(){cnc=document.getElementById("cnc");cncCtx=cnc.getContext("2d");tool=initTool("tools/tool.bmp")}function moveTool(d,a,c,b){if(b>=c.length){return}if(b){drawGhostTool(d,a,c[b-1])}drawTool(d,a,c[b]);setTimeout(function(){moveTool(d,a,c,b+1)},5)}function drawTool(a,b,e){var c=e.z;var d=-e.x-b.height;a.drawImage(b.toolCanvas,c,d)}function drawGhostTool(a,b,d){var c=-d.x-b.height;a.drawImage(b.ghostCanvas,d.z,c);a.drawImage(b.invertedGhostCanvas,d.z,d.x)}function initTool(j){var h=document.createElement("img");h.src=j;var b=document.createElement("canvas");b.width=h.width;b.height=h.height;var o=b.getContext("2d");o.drawImage(h,0,0);var k=o.getImageData(0,0,b.width,b.height);var c=o.getImageData(0,0,b.width,b.height);for(var d=0;d<k.data.length;d+=4){if(k.data[d]===255&&k.data[d+1]===0&&k.data[d+2]===255){k.data[d+3]=0;c.data[d+3]=0}else{c.data[d]=255;c.data[d+1]=255;c.data[d+2]=255;c.data[d+3]=255}}var g=document.createElement("canvas");g.width=h.width;g.height=h.height;var n=g.getContext("2d");n.putImageData(k,0,0);var e=document.createElement("canvas");e.height=h.height;e.width=h.width;var a=e.getContext("2d");a.putImageData(c,0,0);var m=document.createElement("canvas");m.height=h.height;m.width=h.width;var l=m.getContext("2d");l.translate(0,h.height);l.scale(1,-1);l.drawImage(e,0,0);var f={width:h.width,height:h.height,toolCanvas:g,ghostCanvas:e,invertedGhostCanvas:m};return f};