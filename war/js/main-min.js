$(document).ready(function(){$("#editorDiv").load("examples/complete.cnc");initScreen();setTimeout(function(){run()},500);$(window).resize(function(){initScreen()});$("#btnStart").click(function(){if($(this).text()==="Start"){run();$(this).text("Stop")}else{stop();$(this).text("Start")}})});function test(){if($("#options").right<0){$("#options").animate({right:-300},"fast")}else{$("#options").animate({right:0},"fast")}}var MYAPP={};function stop(){MYAPP.codeRunner&&MYAPP.codeRunner.terminate()}function run(){delete MYAPP.prevPoint;initSimulation();MYAPP.codeRunner=new Worker("js/parser-min.js");var c=$("#editorDiv").val().toUpperCase().split("\n");var b=getBillet(c);var a=this;MYAPP.codeRunner.addEventListener("message",function(d){if(MYAPP.prevPoint){drawGhostTool(cncCtx,tool,MYAPP.prevPoint)}if(d.data==="The End"){$("#btnStart").text("Start");return}drawTool(cncCtx,tool,d.data);MYAPP.prevPoint=d.data},false);cnc.width=cnc.width;cncCtx.translate(b.length,Math.ceil(cnc.height/2));drawBillet(b);MYAPP.codeRunner.postMessage($("#editorDiv").val().toUpperCase())}function getBillet(e){var b;var j=false;for(line in e){b=e[line];if(b.indexOf("[BILLET")>=0){j=true;break}}if(!j){var i="Billet size not found";console.log(i);throw i}var g=/\sX\d+\s/;var f=g.exec(b);if(!f){var i="Billet radius not found";console.log(i);throw i}var h=/\sZ\d+\s?/;var c=h.exec(b);if(!c){var i="Billet length not found";console.log(i);throw i}var d=/\d+/;f=d.exec(f);c=d.exec(c);var a={radius:f[0],length:c[0],properties:billetProperties};return a}function initScreen(){document.body.style.height=window.innerHeight+"px";var d=window.innerHeight;var a={toolbarHeight:40,footerHeight:30,editorWidth:300,topPadding:3,leftPadding:4,lineNumbersWidth:30};$("#toolbar").css("height",a.toolbarHeight+"px");$("#footer").css("height",a.footerHeight+"px");$("#editor").css("height",(window.innerHeight-a.toolbarHeight-a.footerHeight)+"px");$("#editor").css("width",a.editorWidth+"px");$("#editorDiv").css("height",(window.innerHeight-a.toolbarHeight-a.footerHeight-a.topPadding-1)+"px");$("#editorDiv").css("width",(a.editorWidth-a.leftPadding-a.lineNumbersWidth)+"px");$("#simulator").css("height",(window.innerHeight-a.toolbarHeight-a.footerHeight)+"px");$("#simulator").css("width",(window.innerWidth-a.editorWidth)+"px");$("#lineNumbers").css("height",(window.innerHeight-a.toolbarHeight-a.footerHeight-a.topPadding)+"px");$("#lineNumbers").css("width",(a.lineNumbersWidth-4)+"px");$("#lineNumbers").css("padding-top",a.topPadding+"px");$("#options").css("height",(window.innerHeight-a.toolbarHeight-a.footerHeight)+"px");$("#cnc").remove();var c=document.createElement("canvas");c.setAttribute("id","cnc");c.height=(window.innerHeight-a.toolbarHeight-a.footerHeight);c.width=(window.innerWidth-a.editorWidth);var b=document.getElementById("simulator");b.appendChild(c)};