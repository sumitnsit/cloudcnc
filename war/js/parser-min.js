importScripts("gcodes-min.js");function executeStatement(b,a){switch(b.cncCode){case"G00":return calculateG00(a.x,a.z,b.X,b.Z);break;case"G01":return calculateG01(a.x,a.z,b.X,b.Z);break;case"G02":return calculateG02(a.x,a.z,b.X,b.Z,b.R);break;case"G03":return calculateG03(a.x,a.z,b.X,b.Z,b.R);break;case"G28":return calculateG28(a.x,a.z,b.X,b.Z);break;case"G90":return calculateG90(a.x,a.z,b.X,b.Z,b.R);break;case"G94":return calculateG94(a.x,a.z,b.X,b.Z,b.R);break;default:}}var console={log:function(){}};function start(b){console.log("Starting program");var f=b.split("\n");console.log("Number of lines of code: "+f.length);var h;var c;var g=100,e=100,j,k;var a={x:g,z:e};for(line in f){if(!f[line].trim()){continue}if(f[line].trim().indexOf("[")===0){continue}console.log("Statement: "+f[line]);h=getStatement(f[line]);h.cncCode=h.cncCode||k;h.X=h.X||g;h.Z=h.Z||e;h.R=h.R||j;console.log("Statement object: "+h.toString());c=executeStatement(h,a);for(index in c){for(var d=0;d<300000;d++){}self.postMessage(c[index])}if(c){a.x=c[c.length-1].x;a.z=c[c.length-1].z}g=h.X;e=h.Z;j=h.R;k=h.cncCode}self.postMessage("The End")}function getStatement(a){var d={};var c=/[GM]\d+/;var e=c.exec(a);d.cncCode=e&&e[0];var b=/[XZRUWF]-?\d+\.?\d*/g;while(temp=b.exec(a)){d[temp[0].charAt(0)]=temp[0].substring(1)}d.toString=function(){var g,f="";for(g in this){if(this.hasOwnProperty(g)&&typeof this.prop!=="function"){f+=g+": "+this[g]+"\n"}}return f};return d}self.addEventListener("message",function(a){start(a.data)},false);